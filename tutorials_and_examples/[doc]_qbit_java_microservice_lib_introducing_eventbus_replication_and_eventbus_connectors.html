<!DOCTYPE HTML>
<html lang="en-US" >
    
    <head>
        
        <meta charset="UTF-8">
        <title>[Doc] QBit Java microservice lib introducing EventBus replication and EventBus connectors | Introduction to QBit - The microservice Library for Java</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 1.0.3">
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    
    
    
    <link rel="next" href="../tutorials_and_examples/[quick_start]_building_a_single_web_page_application_with_qbit.html" />
    
    
    <link rel="prev" href="../tutorials_and_examples/[rough_cut]_working_with_strongly_typed_event_bus_proxies_for_qbit_java_microservice_lib.html" />
    

        
    </head>
    <body>
        
        
<link rel="stylesheet" href="../gitbook/style.css">


        
    <div class="book"  data-level="1.14" data-basepath=".." data-revision="1426023905951">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
    	
    	
    	

        

        
    
        
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                        <i class="fa fa-check"></i>
                        
                         Introduction
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="0.1" data-path="what_is_qbit.html">
            
                
                    <a href="../what_is_qbit.html">
                        <i class="fa fa-check"></i>
                        
                            <b>0.1.</b>
                        
                         What is Qbit?
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="0.2" data-path="qbits_philosophy_and_inspiration.html">
            
                
                    <a href="../qbits_philosophy_and_inspiration.html">
                        <i class="fa fa-check"></i>
                        
                            <b>0.2.</b>
                        
                         QBit&#39;s Philosophy and inspiration
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="0.3" data-path="does_it_work.html">
            
                
                    <a href="../does_it_work.html">
                        <i class="fa fa-check"></i>
                        
                            <b>0.3.</b>
                        
                         Does it work?
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="1" data-path="tutorials_and_examples/README.html">
            
                
                    <a href="../tutorials_and_examples/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                         Tutorials and Examples
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="1.1" data-path="tutorials_and_examples/[quick_start]_building_qbit_the_microservice_lib_for_java.html">
            
                
                    <a href="../tutorials_and_examples/[quick_start]_building_qbit_the_microservice_lib_for_java.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                         [Quick Start] Building QBit the microservice lib for Java
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.2" data-path="tutorials_and_examples/[quick_start]_building_boon_for_the_qbit_microservice_engine.html">
            
                
                    <a href="../tutorials_and_examples/[quick_start]_building_boon_for_the_qbit_microservice_engine.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                         [Quick Start] Building boon for the QBit microservice engine
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.3" data-path="tutorials_and_examples/[quick_start]_building_a_todo_web_microservice_server_with_qbit.html">
            
                
                    <a href="../tutorials_and_examples/[quick_start]_building_a_todo_web_microservice_server_with_qbit.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.3.</b>
                        
                         [Quick Start] Building a TODO web microservice server with QBit
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.4" data-path="tutorials_and_examples/[quick_start]_building_a_todo_web_microservice_client_with_qbit.html">
            
                
                    <a href="../tutorials_and_examples/[quick_start]_building_a_todo_web_microservice_client_with_qbit.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.4.</b>
                        
                         [Quick Start] Building a TODO web microservice client with QBit
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.5" data-path="tutorials_and_examples/[quick_start]_building_a_simple_rest_web_microservice_server_with_qbit.html">
            
                
                    <a href="../tutorials_and_examples/[quick_start]_building_a_simple_rest_web_microservice_server_with_qbit.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.5.</b>
                        
                         [Quick Start] Building a simple Rest web microservice server with QBit
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.6" data-path="tutorials_and_examples/[rough_cut]_using_qbit_microservice_libs_rest_support_with_uri_params.html">
            
                
                    <a href="../tutorials_and_examples/[rough_cut]_using_qbit_microservice_libs_rest_support_with_uri_params.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.6.</b>
                        
                         [Rough Cut] Using QBit microservice lib&#39;s REST support with URI Params
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.7" data-path="tutorials_and_examples/[quick_start]_working_with_inproc_microservices_within_qbit.html">
            
                
                    <a href="../tutorials_and_examples/[quick_start]_working_with_inproc_microservices_within_qbit.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.7.</b>
                        
                         [Quick Start] Working with inproc MicroServices within QBit
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.8" data-path="tutorials_and_examples/[detailed_tutorial]_working_with_inproc_microservices_within_qbit.html">
            
                
                    <a href="../tutorials_and_examples/[detailed_tutorial]_working_with_inproc_microservices_within_qbit.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.8.</b>
                        
                         [Detailed Tutorial] Working with inproc MicroServices within QBit.
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.9" data-path="tutorials_and_examples/[rough_cut]_working_with_inproc_microservices.html">
            
                
                    <a href="../tutorials_and_examples/[rough_cut]_working_with_inproc_microservices.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.9.</b>
                        
                         [Rough Cut] Working with inproc MicroServices
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.10" data-path="tutorials_and_examples/[doc]_using_qbit_microservice_libs_httpclient_get,_post,_et_al,_json,_java_8_lambda.html">
            
                
                    <a href="../tutorials_and_examples/[doc]_using_qbit_microservice_libs_httpclient_get,_post,_et_al,_json,_java_8_lambda.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.10.</b>
                        
                         [Doc] Using QBit microservice lib&#39;s HttpClient GET, POST, et al, JSON, Java 8 Lambda
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.11" data-path="tutorials_and_examples/[rough_cut]_working_with_event_bus_for_qbit_the_microservice_engine.html">
            
                
                    <a href="../tutorials_and_examples/[rough_cut]_working_with_event_bus_for_qbit_the_microservice_engine.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.11.</b>
                        
                         [Rough Cut] Working with event bus for QBit the microservice engine
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.12" data-path="tutorials_and_examples/[rough_cut]_working_with_private_event_bus_for_inproc_microservices.html">
            
                
                    <a href="../tutorials_and_examples/[rough_cut]_working_with_private_event_bus_for_inproc_microservices.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.12.</b>
                        
                         [Rough Cut] Working with private event bus for inproc microservices
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.13" data-path="tutorials_and_examples/[rough_cut]_working_with_strongly_typed_event_bus_proxies_for_qbit_java_microservice_lib.html">
            
                
                    <a href="../tutorials_and_examples/[rough_cut]_working_with_strongly_typed_event_bus_proxies_for_qbit_java_microservice_lib.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.13.</b>
                        
                         [Rough Cut] Working with strongly typed event bus proxies for QBit Java Microservice lib
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter active" data-level="1.14" data-path="tutorials_and_examples/[doc]_qbit_java_microservice_lib_introducing_eventbus_replication_and_eventbus_connectors.html">
            
                
                    <a href="../tutorials_and_examples/[doc]_qbit_java_microservice_lib_introducing_eventbus_replication_and_eventbus_connectors.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.14.</b>
                        
                         [Doc] QBit Java microservice lib introducing EventBus replication and EventBus connectors
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.15" data-path="tutorials_and_examples/[quick_start]_building_a_single_web_page_application_with_qbit.html">
            
                
                    <a href="../tutorials_and_examples/[quick_start]_building_a_single_web_page_application_with_qbit.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.15.</b>
                        
                         [Quick Start] building a single web page application with QBit
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.16" data-path="tutorials_and_examples/[rough_cut]_delivering_up_single_page_applications_from_qbit_java_json_microservice_lib.html">
            
                
                    <a href="../tutorials_and_examples/[rough_cut]_delivering_up_single_page_applications_from_qbit_java_json_microservice_lib.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.16.</b>
                        
                         [Rough Cut] Delivering up Single Page Applications from QBit Java JSON Microservice lib
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.17" data-path="tutorials_and_examples/[quick_start]_building_a_single_page_todo_list_application_with_qbit.html">
            
                
                    <a href="../tutorials_and_examples/[quick_start]_building_a_single_page_todo_list_application_with_qbit.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.17.</b>
                        
                         [Quick Start] Building a single page; Todo List Application with QBit
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.18" data-path="tutorials_and_examples/[detailed_tutorial]_building_a_single_page_todo_list_application_with_qbit.html">
            
                
                    <a href="../tutorials_and_examples/[detailed_tutorial]_building_a_single_page_todo_list_application_with_qbit.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.18.</b>
                        
                         [Detailed Tutorial] Building a single page; Todo List Application with QBit
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.19" data-path="tutorials_and_examples/[rough_cut]_using_qbit_microservice_lib_with_spring_boot.html">
            
                
                    <a href="../tutorials_and_examples/[rough_cut]_using_qbit_microservice_lib_with_spring_boot.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.19.</b>
                        
                         [Rough Cut] Using QBit microservice lib with Spring Boot
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.20" data-path="tutorials_and_examples/[rough_cut]_working_with_system_manager_for_qbit_mircoservice_lib.html">
            
                
                    <a href="../tutorials_and_examples/[rough_cut]_working_with_system_manager_for_qbit_mircoservice_lib.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.20.</b>
                        
                         [Rough Cut] Working with System Manager for QBit Mircoservice lib
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.21" data-path="tutorials_and_examples/[rough_cut]_qbit_microservices_using_service_workers_and_sharded_service_workers.html">
            
                
                    <a href="../tutorials_and_examples/[rough_cut]_qbit_microservices_using_service_workers_and_sharded_service_workers.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.21.</b>
                        
                         [Rough Cut] QBit Microservices using Service Workers and sharded service workers
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.22" data-path="tutorials_and_examples/[rough_cut]_qbit_microservice_lib_working_with_callbacks.html">
            
                
                    <a href="../tutorials_and_examples/[rough_cut]_qbit_microservice_lib_working_with_callbacks.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.22.</b>
                        
                         [Rough Cut] QBit Microservice Lib Working With CallBacks
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.23" data-path="tutorials_and_examples/[doc]_queue_callbacks_for_qbit_queue_based_services.html">
            
                
                    <a href="../tutorials_and_examples/[doc]_queue_callbacks_for_qbit_queue_based_services.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.23.</b>
                        
                         [Doc] Queue Callbacks for QBit queue based services
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.24" data-path="tutorials_and_examples/[rough_cut]_qbit_java_microservice_lib_working_with_workers_sharded_and_pooled.html">
            
                
                    <a href="../tutorials_and_examples/[rough_cut]_qbit_java_microservice_lib_working_with_workers_sharded_and_pooled.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.24.</b>
                        
                         [Rough Cut] QBit Java Microservice Lib Working With Workers Sharded and Pooled
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.25" data-path="tutorials_and_examples/[doc]_using_qbit_microservice_libs_websocket_support.html">
            
                
                    <a href="../tutorials_and_examples/[doc]_using_qbit_microservice_libs_websocket_support.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.25.</b>
                        
                         [Doc] Using QBit microservice lib&#39;s WebSocket support
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.26" data-path="tutorials_and_examples/[doc]_qbit_microservice_java_lib_using_auto_flushing_client_proxies.html">
            
                
                    <a href="../tutorials_and_examples/[doc]_qbit_microservice_java_lib_using_auto_flushing_client_proxies.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.26.</b>
                        
                         [Doc] QBit microservice Java lib Using auto flushing client proxies
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.27" data-path="tutorials_and_examples/[doc]_qbit_microservice_websocket_wire_protocol_draft_01___json_ascii_method_batching_rpc.html">
            
                
                    <a href="../tutorials_and_examples/[doc]_qbit_microservice_websocket_wire_protocol_draft_01___json_ascii_method_batching_rpc.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.27.</b>
                        
                         [Doc] QBit Microservice WebSocket wire protocol draft 01   JSON ASCII method batching RPC
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.28" data-path="tutorials_and_examples/[doc]_qbit_java_microservice_lib_auto_flushing_service_queue_proxies.html">
            
                
                    <a href="../tutorials_and_examples/[doc]_qbit_java_microservice_lib_auto_flushing_service_queue_proxies.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.28.</b>
                        
                         [Doc] QBit Java microservice lib auto flushing service queue proxies
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="2" data-path="qbit_roadmap/README.html">
            
                
                    <a href="../qbit_roadmap/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                         Qbit Roadmap
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3" data-path="contact_us/README.html">
            
                
                    <a href="../contact_us/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                         Contact Us
                    </a>
                
            
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank" class="gitbook-link">Published using GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Toggle summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Toggle search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle font settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle share dropdown"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">Twitter</button>
                <button type="button" data-sharing="google-plus" class="button">Google</button>
                <button type="button" data-sharing="facebook" class="button">Facebook</button>
                <button type="button" data-sharing="weibo" class="button">Weibo</button>
                <button type="button" data-sharing="instapaper" class="button">Instapaper</button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Share on Google Plus"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Share on Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Share on Twitter"><i class="fa fa-twitter"></i></a>
    
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >Introduction to QBit - The microservice Library for Java</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-gitbook_1478">
                    
                        <h1 id="doc-qbit-java-microservice-lib-introducing-eventbus-replication-and-eventbus-connectors">[Doc] QBit Java microservice lib introducing EventBus replication and EventBus connectors</h1>
<p>QBit has an event bus.</p>
<p>It is useful for services to listen to events.
Events are treated like method calls and that they can be handled by the same thread that handles the service method calls so modification of the state of the service is handled in one thread negating the need for complex thread management and synchronization.</p>
<p>If you are new to QBit events please start here:</p>
<ul>
<li><a href="https://github.com/advantageous/qbit/wiki/%5BRough-Cut%5D-Working-with-event-bus-for-QBit-the-microservice-engine" target="_blank">QBit Event Bus more detailed example</a></li>
<li><a href="https://github.com/advantageous/qbit/wiki/%5BRough-Cut%5D-Working-with-private-event-bus-for-inproc-microservices" target="_blank">QBit Microservice working with a private event bus</a></li>
<li><a href="https://github.com/advantageous/qbit/wiki/%5BRough-Cut%5D-Working-with-strongly-typed-event-bus-proxies-for-QBit-Java-Microservice-lib" target="_blank">QBit Java Microservice lib using your own interface to the event bus</a>.</li>
</ul>
<p>Then come back to this more advanced topic and for some background on the QBit event bus.</p>
<h2 id="remote-events-and-event-connectors">Remote events and event connectors</h2>
<p>QBit now has the ability to send events over a remote connection.</p>
<p>Every event manager <code>EventManager</code> talks to an <code>EventBus</code> which talks to a series of <code>Channels</code>. <code>Channels</code> are like topics and they manage a collection of listeners. There are adapters that can move an event from a <code>Channel</code> to a <code>ServiceQueue</code>.</p>
<p>To support integration with other event busses and remote event busses we added the concept of an <code>EventConnector</code>. The <code>EventBus</code> sends all events to its <code>EventConnector</code>. The default <code>EventConnector</code> is a no-op <code>EventConnector</code>. You can plug in additional event connection with the <code>EventConnector</code>.</p>
<p>The <code>EventConnector</code> interface is a simple one.</p>
<pre><code class="lang-java"><span class="hljs-keyword">package</span> io.advantageous.qbit.events.spi;

<span class="hljs-keyword">import</span> io.advantageous.qbit.service.ServiceFlushable;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">EventConnector</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ServiceFlushable</span></span>{


    <span class="hljs-javadoc">/** Forwards the event.
     *<span class="hljs-javadoctag"> @param</span> event   event
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">forwardEvent</span><span class="hljs-params">(EventTransferObject&lt;Object&gt; event)</span></span>;

    <span class="hljs-function"><span class="hljs-keyword">default</span> <span class="hljs-keyword">void</span> <span class="hljs-title">flush</span><span class="hljs-params">()</span> </span>{

    }
}
</code></pre>
<h2 id="eventmanagerbuilder">EventManagerBuilder</h2>
<p>Since constructing an event manager is more complicated now, we added an EventManager builder which allows you to specify Predicates which then determine if an event should be replicated by the event connector.</p>
<h4 id="using-event-manager-builder">Using Event manager builder</h4>
<pre><code class="lang-java">


        EventManagerBuilder eventManagerBuilder = eventManagerBuilder();

        eventManagerBuilder.setEventConnector(eventConnector);

        eventManagerBuilder.addEventConnectorPredicate(objectEvent -&gt; apples.isColor(<span class="hljs-string">"Red"</span>) );

        eventManagerBuilder.addEventConnectorPredicate(objectEvent -&gt; day.is(<span class="hljs-string">"Tuesday"</span>) );

        EventManager build = eventManagerBuilder.build();
</code></pre>
<p>We also added another SPI class for events that implements the Event interface.</p>
<h4 id="event-transfer-object-for-sending-events">Event Transfer Object for sending events</h4>
<pre><code class="lang-java">

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EventTransferObject</span>&lt;<span class="hljs-title">T</span>&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title">Event</span>&lt;<span class="hljs-title">T</span>&gt; </span>{
</code></pre>
<p>This is a concrete class that gets passed for connecting events.</p>
<p>We also added a utility class for connecting event managers easily.</p>
<h4 id="simpleeventconnector-for-connecting-eventmanagers">SimpleEventConnector for connecting EventManagers.</h4>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SimpleEventConnector</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">EventConnector</span> </span>{

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> EventManager eventManager;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">SimpleEventConnector</span><span class="hljs-params">(EventManager eventManager)</span> </span>{
        <span class="hljs-keyword">this</span>.eventManager = eventManager;
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">forwardEvent</span><span class="hljs-params">(EventTransferObject&lt;Object&gt; event)</span> </span>{

        <span class="hljs-keyword">this</span>.eventManager.forwardEvent(event);

    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">flush</span><span class="hljs-params">()</span> </span>{

        flushServiceProxy(eventManager);
    }
}
</code></pre>
<p>One can imagine using the predicate of the builder and SimpleEventConnector to channel events to certain event managers.</p>
<h2 id="remote-event-bus-replication-and-connection">Remote Event Bus replication and connection</h2>
<p>None of this is required for the simple cases.</p>
<p>There is now a subproject that provides remote event replication support: <code>qbit-eventbus-replicator</code>.</p>
<p>You can use this to replicate events:</p>
<p>Let&#39;s say that you have two event busses:</p>
<h4 id="eventmanager-a">EventManager A</h4>
<pre><code class="lang-java">
        <span class="hljs-javadoc">/** Two event managers A and B. Event on A gets replicated to B. */</span>

        EventManager eventManagerA;
</code></pre>
<h4 id="eventmanager-b-who-will-listen-remotely-to-a">EventManager B who will listen remotely to A</h4>
<pre><code class="lang-java">
        EventManager eventManagerB;
</code></pre>
<p>You want events that happen on A to be transmitted to B. Now A and B are on two different server instances on two different JVMs.</p>
<p>Let&#39;s setup our EventB service bus.</p>
<h4 id="eventmanager-b-start-up">EventManager B Start up</h4>
<pre><code class="lang-java">
        EventManagerBuilder eventManagerBuilderB = <span class="hljs-keyword">new</span> EventManagerBuilder();
        <span class="hljs-javadoc">/** Build B. */</span>
        EventManager eventManagerBImpl = eventManagerBuilderB.build();
</code></pre>
<p>Create a service bundle and add event manager B to it.</p>
<h4 id="eventmanager-b-start-up-2">EventManager B Start up 2</h4>
<pre><code class="lang-java">        serviceBundle = serviceBundleBuilder().build(); <span class="hljs-comment">//build service bundle</span>
        serviceBundle.addServiceObject(<span class="hljs-string">"eventManagerB"</span>, eventManagerBImpl);
</code></pre>
<p>Create a service queue client proxy to B and register for events.</p>
<h4 id="eventmanager-b-create-service-queue-proxy-and-listen-for-an-event-foobar">EventManager B create service queue proxy and listen for an event foo.bar</h4>
<pre><code class="lang-java">        eventManagerB = serviceBundle.createLocalProxy(EventManager.class, <span class="hljs-string">"eventManagerB"</span>);
        eventManagerB.register(<span class="hljs-string">"foo.bar"</span>, event -&gt;  body.set(event.body()));
</code></pre>
<p>Now we want B to listen to calls from a remote event bus. To do this we use a <code>EventRemoteReplicatorService</code>
which is a service that is easy to expose via WebSockets/REST for handing remote event calls.</p>
<p>To make <code>EventRemoteReplicatorService</code> easy to use, we added a <code>EventBusRemoteReplicatorBuilder</code>.</p>
<h4 id="using-eventremotereplicatorservice-via-eventbusremotereplicatorbuilder">Using EventRemoteReplicatorService via EventBusRemoteReplicatorBuilder</h4>
<pre><code class="lang-java">
        EventBusRemoteReplicatorBuilder replicatorBuilder = eventBusRemoteReplicatorBuilder();
        replicatorBuilder.serviceServerBuilder().setPort(<span class="hljs-number">9097</span>);
        replicatorBuilder.setEventManager(eventManagerB);
        ServiceServer serviceServer = replicatorBuilder.build();
</code></pre>
<p>You can pass <code>EventBusRemoteReplicatorBuilder</code> a serviceServerBuilder or it will construct one.
Notice above we call</p>
<h4 id="telling-eventremotereplicatorservice-which-event-bus-to-replicate-to">Telling EventRemoteReplicatorService which event bus to replicate to</h4>
<pre><code class="lang-java">        replicatorBuilder.setEventManager(eventManagerB);
</code></pre>
<p>This connects the <code>eventManagerB</code> to the <code>EventRemoteReplicatorService</code> which is exposed via WebSockets to handle remote calls.</p>
<p><code>EventRemoteReplicatorService</code> is a <code>EventConnector</code>. This means when we start up <code>eventManagerA</code> on the other server, all we have to do is pass the proxy client to <code>EventRemoteReplicatorService</code> into <code>eventManagerA</code> and all the events from A will be replicated to <code>eventManagerB</code>.</p>
<p>To connect A to B, we need a WebSocket QBit proxy client to the replication running in the B server. To do this we provided a utility builder class called <code>EventBusReplicationClientBuilder</code> as follows:</p>
<h4 id="creating-an-eventconnector-that-talks-to-the-eventremotereplicatorservice-running-on-b">Creating an EventConnector that talks to the EventRemoteReplicatorService running on B</h4>
<pre><code class="lang-java">        EventConnector replicatorClient;
        ...

        EventBusReplicationClientBuilder clientReplicatorBuilder = eventBusReplicationClientBuilder();
        clientReplicatorBuilder.clientBuilder().setPort(<span class="hljs-number">9097</span>);
        Client client = clientReplicatorBuilder.build();

        replicatorClient = clientReplicatorBuilder.build(client);
</code></pre>
<p>Calls to the <code>replicatorClient</code> get sent to the remote replicator running in server B.</p>
<p>Now we just wire the A event bus to call the replicatorClient.</p>
<h4 id="wiring-up-event-bus-a">Wiring up event bus A</h4>
<pre><code class="lang-java">
        <span class="hljs-comment">/* Create A that connects to the replicator client. */</span>
        EventManager eventManagerAImpl =
              eventManagerBuilderA.setEventConnector(replicatorClient).build();
        serviceBundleA = serviceBundleBuilder().build(); <span class="hljs-comment">//build service bundle</span>
         <span class="hljs-comment">/* Wire in the bus. */</span>
        serviceBundleA.addServiceObject(<span class="hljs-string">"eventManagerA"</span>, eventManagerAImpl);
        <span class="hljs-comment">/* Create a proxy client so we can use it over the service queue. */</span>
        eventManagerA = serviceBundleA.createLocalProxy(EventManager.class, <span class="hljs-string">"eventManagerA"</span>);
</code></pre>
<p>Now we can listen on B running on another machine:</p>
<h4 id="listening-on-b">Listening on B</h4>
<pre><code class="lang-java">
        eventManagerB.register(<span class="hljs-string">"foo.bar"</span>, event -&gt;  handleEvent(event.body()));
</code></pre>
<p>And when events get sent to A, they are also sent to B.</p>
<h4 id="sending-on-a">Sending on A</h4>
<pre><code class="lang-java">

        eventManagerA.send(<span class="hljs-string">"foo.bar"</span>, <span class="hljs-string">"hello"</span>);
</code></pre>
<p>We just created a listener running on a remote server.</p>
<p>Here is a complete example:</p>
<pre><code class="lang-java"><span class="hljs-keyword">package</span> io.advantageous.qbit.events.impl;

<span class="hljs-keyword">import</span> io.advantageous.qbit.client.Client;
<span class="hljs-keyword">import</span> io.advantageous.qbit.events.EventManager;
<span class="hljs-keyword">import</span> io.advantageous.qbit.events.EventManagerBuilder;
<span class="hljs-keyword">import</span> io.advantageous.qbit.events.spi.EventConnector;
<span class="hljs-keyword">import</span> io.advantageous.qbit.server.ServiceServer;
<span class="hljs-keyword">import</span> io.advantageous.qbit.service.ServiceBundle;
<span class="hljs-keyword">import</span> io.advantageous.qbit.service.ServiceProxyUtils;
<span class="hljs-keyword">import</span> io.advantageous.qbit.test.TimedTesting;
<span class="hljs-keyword">import</span> org.boon.core.Sys;
<span class="hljs-keyword">import</span> org.junit.Test;

<span class="hljs-keyword">import</span> java.util.concurrent.atomic.AtomicReference;

<span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> io.advantageous.qbit.events.impl.EventBusRemoteReplicatorBuilder.eventBusRemoteReplicatorBuilder;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> io.advantageous.qbit.events.impl.EventBusReplicationClientBuilder.eventBusReplicationClientBuilder;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> io.advantageous.qbit.service.ServiceBundleBuilder.serviceBundleBuilder;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> org.junit.Assert.assertEquals;

<span class="hljs-javadoc">/**
 *<span class="hljs-javadoctag"> @author</span> rhightower
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EventManagerReplicationOverWebSocket</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">TimedTesting</span> </span>{

    EventConnector replicatorClient;
    ServiceBundle serviceBundleB;
    ServiceBundle serviceBundleA;


    <span class="hljs-annotation">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>{


        <span class="hljs-javadoc">/** Two event managers A and B. Event on A gets replicated to B. */</span>

        EventManager eventManagerA;
        EventManager eventManagerB;

        EventManagerBuilder eventManagerBuilderA = <span class="hljs-keyword">new</span> EventManagerBuilder();
        EventManagerBuilder eventManagerBuilderB = <span class="hljs-keyword">new</span> EventManagerBuilder();


        <span class="hljs-javadoc">/** Build B. */</span>
        EventManager eventManagerBImpl = eventManagerBuilderB.build();
        serviceBundleB = serviceBundleBuilder().build(); <span class="hljs-comment">//build service bundle</span>
        serviceBundleB.addServiceObject(<span class="hljs-string">"eventManagerB"</span>, eventManagerBImpl);
        eventManagerB = serviceBundleB.createLocalProxy(EventManager.class, <span class="hljs-string">"eventManagerB"</span>); <span class="hljs-comment">//wire B to Service Bundle</span>

        EventBusRemoteReplicatorBuilder replicatorBuilder = eventBusRemoteReplicatorBuilder();
        replicatorBuilder.serviceServerBuilder().setPort(<span class="hljs-number">9097</span>);
        replicatorBuilder.setEventManager(eventManagerB);
        ServiceServer serviceServer = replicatorBuilder.build();

        EventBusReplicationClientBuilder clientReplicatorBuilder = eventBusReplicationClientBuilder();
        clientReplicatorBuilder.clientBuilder().setPort(<span class="hljs-number">9097</span>);
        Client client = clientReplicatorBuilder.build();
        replicatorClient = clientReplicatorBuilder.build(client);

        serviceServer.start();
        client.start();

        <span class="hljs-comment">/* Create A that connects to the replicator client. */</span>
        EventManager eventManagerAImpl = eventManagerBuilderA.setEventConnector(replicatorClient).build();
        serviceBundleA = serviceBundleBuilder().build(); <span class="hljs-comment">//build service bundle</span>
        serviceBundleA.addServiceObject(<span class="hljs-string">"eventManagerA"</span>, eventManagerAImpl);
        eventManagerA = serviceBundleA.createLocalProxy(EventManager.class, <span class="hljs-string">"eventManagerA"</span>); <span class="hljs-comment">//wire A to Service Bundle</span>


        serviceBundleA.start();

        serviceBundleB.start();


        <span class="hljs-keyword">final</span> AtomicReference&lt;Object&gt; body = <span class="hljs-keyword">new</span> AtomicReference&lt;&gt;();

        eventManagerB.register(<span class="hljs-string">"foo.bar"</span>, event -&gt;  body.set(event.body()));

        eventManagerA.send(<span class="hljs-string">"foo.bar"</span>, <span class="hljs-string">"hello"</span>);
        ServiceProxyUtils.flushServiceProxy(eventManagerA);

        waitForTrigger(<span class="hljs-number">20</span>, o -&gt; body.get()!=<span class="hljs-keyword">null</span>);


        assertEquals(<span class="hljs-string">"hello"</span>, body.get());

        serviceBundleA.stop();
        serviceBundleB.stop();
        client.stop();
        Sys.sleep(<span class="hljs-number">100</span>);
        serviceServer.stop();
    }


}
</code></pre>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../tutorials_and_examples/[rough_cut]_working_with_strongly_typed_event_bus_proxies_for_qbit_java_microservice_lib.html" class="navigation navigation-prev " aria-label="Previous page: [Rough Cut] Working with strongly typed event bus proxies for QBit Java Microservice lib"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../tutorials_and_examples/[quick_start]_building_a_single_web_page_application_with_qbit.html" class="navigation navigation-next " aria-label="Next page: [Quick Start] building a single web page application with QBit"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="https://cdn.mathjax.org/mathjax/2.4-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-mathjax/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
